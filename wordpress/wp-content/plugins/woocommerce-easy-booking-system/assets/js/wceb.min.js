var wceb={productType:wceb_object.product_type,calcMode:wceb_object.calc_mode,maxYear:parseInt(wceb_object.max_year),maxOption:new Date(parseInt(wceb_object.max_year),11,31),allowDisabled:wceb_object.allow_disabled,session:!1,checkIf:{isDate:null,isDay:null,isArray:null,isObject:null,isDisabled:null,dateIsSet:null,datesAreSet:null},get:{firstAvailableDate:null,basePrice:null,additionalCosts:null,childrenIds:null,minAndMax:null,closestDisabled:null,closest:null},createDateObject:null,clearBookingSession:null,applyBookingDuration:null,formatPrice:null,setPrice:null,picker:{close:null,set:null},pickers:{init:null,render:null,clearSecond:null,set:null}};!function(e){e(document).ready(function(){$inputStart=e(".datepicker_start").pickadate(),pickerStart=$inputStart.pickadate("picker"),pickerStartItem=pickerStart.component.item,$inputEnd=e(".datepicker_end").pickadate(),pickerEnd=$inputEnd.pickadate("picker"),pickerEndItem=pickerEnd.component.item;var t={startFormat:null,endFormat:null,start:null,end:null};wceb.checkIf.isDate=function(e){return e instanceof Date},wceb.checkIf.isDay=function(e){return!isNaN(e)&&e>=1&&e<=7},wceb.checkIf.isArray=function(e){return e instanceof Array},wceb.checkIf.isObject=function(e){return"object"==typeof e&&!(e instanceof Date)},wceb.checkIf.isDisabled=function(t,a){if("undefined"==typeof t)return!1;var r=!1,i=a.pick;return e.each(t,function(e,t){if(wceb.checkIf.isArray(t)){if(t=new Date(t[0],t[1],t[2]),i===t.getTime())return void(r=!0)}else if(wceb.checkIf.isObject(t)){if(start=new Date(t.from[0],t.from[1],t.from[2]),end=new Date(t.to[0],t.to[1],t.to[2]),i>=start.getTime()&&i<=end.getTime())return void(r=!0)}else if(wceb.checkIf.isDay(t)){var c=a.day;if(0===c&&(c=7),t===c)return void(r=!0)}else if(wceb.checkIf.isDate(t)&&i===t.getTime())return void(r=!0)}),r},wceb.checkIf.dateIsSet=function(e){if("start"===e)var e=pickerStart.get("select");else if("end"===e)var e=pickerStart.get("select");return"undefined"!=typeof e&&null!==e},wceb.checkIf.datesAreSet=function(){var e=pickerStart.get("select"),t=pickerEnd.get("select");return null!==e&&"undefined"!=typeof e&&null!==t&&"undefined"!=typeof t},wceb.get.firstAvailableDates=function(){var e={},t=+parseInt(wceb.firstDate);if(t<=0)var t=!1;for(var a=wceb.createDateObject(!1,t),r=pickerStartItem.disable;!0===wceb.checkIf.isDisabled(r,a);)var a=wceb.createDateObject(a.obj,1);if(e.start=a,"two"===wceb.dateFormat){for(var i=new Date(a.pick),c=wceb.createDateObject(i,wceb.bookingMin),n=pickerEndItem.disable;!0===wceb.checkIf.isDisabled(n,c);)var c=wceb.createDateObject(c.obj,1);e.end=c}return e},wceb.get.basePrice=function(){if(e(".cart").find('input[name="quantity"]').size())var t=parseFloat(e(".cart").find('input[name="quantity"]').val());else var t=1;var a=parseFloat(e(".booking_price").attr("data-booking_price")),r="two"===wceb.dateFormat&&!wceb.checkIf.datesAreSet()||"one"===wceb.dateFormat&&!wceb.checkIf.dateIsSet("start")?wceb.get.additionalCosts():0,i=parseFloat((r+a)*t);return i},wceb.get.regularPrice=function(){if(e(".cart").find('input[name="quantity"]').size())var t=parseFloat(e(".cart").find('input[name="quantity"]').val());else var t=1;var a=parseFloat(e(".booking_price").attr("data-booking_regular_price")),r="two"===wceb.dateFormat&&!wceb.checkIf.datesAreSet()||"one"===wceb.dateFormat&&wceb.checkIf.dateIsSet("start")?wceb.get.additionalCosts():0,i=parseFloat((r+a)*t);return i},wceb.get.additionalCosts=function(t){var a=0,r={};return"bundle"===wceb.productType&&"each"===t?$selector=e(".product").find("form.cart").find(".cart"):"bundle"===wceb.productType&&"each"!==t?$selector=e(".product").find(".cart.bundle_data"):$selector=e(".product").find("form.cart"),$selector.each(function(){var t=0;e(this).find(".addon").each(function(){var i=0,c=e(this),n=c.parents(".cart");if("undefined"!=typeof n.data("bundle_id"))var o=n.data("product_id"),d=n.data("bundled_item_id"),s=n.find('input[name="bundle_variation_id_'+d+'"]').val(),l="undefined"==typeof s?o:s;if(c.is(".addon-custom-price")?i=c.val():c.is(".addon-input_multiplier")?(isNaN(c.val())||""==c.val()?(c.val(""),c.closest("p").find(".addon-alert").show()):(""!=c.val()&&c.val(Math.ceil(c.val())),c.closest("p").find(".addon-alert").hide()),i=c.data("price")*c.val()):c.is(".addon-checkbox, .addon-radio")?c.is(":checked")&&(i=c.data("price")):c.is(".addon-select")?c.val()&&(i=c.find("option:selected").data("price")):c.val()&&(i=c.data("price")),i||(i=0),a+=i,t+=i,"undefined"!=typeof l)r[l]=t;else{var b=e("input[name=add-to-cart]").val(),u=e(".variations_form").find("input[name=variation_id]").val(),l="undefined"!=typeof u?u:b;r[l]=t}})}),"each"===t?r:a},wceb.get.childrenIds=function(){var t={};if("grouped"===wceb.productType){var a=wceb_object.children;e.each(a,function(a,r){quantity=e('input[name="quantity['+r+']"]').val(),quantity>0&&(t[r]=quantity)})}else if("bundle"===wceb.productType){var r=e(".cart.bundle_data"),i=r.data("bundle_id");if(r.find('input[name="quantity"]').size())var c=r.find('input[name="quantity"]').val();else var c=1;t[i]=c;var n=e("body").find(".bundled_product .cart");n.each(function(){$this=e(this),optional=$this.data("optional"),bundle=$this.data("bundled_item_id"),child=$this.data("product_id"),variation=$this.find('input[name="bundle_variation_id_'+bundle+'"]').val(),quantity=$this.find(".bundled_qty").val();var a="undefined"==typeof variation?child:variation;if("yes"===optional){var r=e('input[name="bundle_selected_optional_'+bundle+'"]').is(":checked");!1===r&&(quantity=0)}""!==a&&quantity>0&&(t[a]=quantity)})}return t},wceb.get.minAndMax=function(e,t){var a=new Date(e.year,e.month,e.date),r=new Date(e.year,e.month,e.date),i=wceb.get.firstAvailableDates(),c="minus"===t?i.start.obj:i.end.obj;if("minus"===t&&""===wceb.bookingMax)var a=c;"plus"===t?(a.setDate(a.getDate()+wceb.bookingMin),""!==wceb.bookingMax&&r.setDate(r.getDate()+wceb.bookingMax)):(r.setDate(r.getDate()-wceb.bookingMin),""!==wceb.bookingMax&&a.setDate(a.getDate()-wceb.bookingMax)),c>a&&(a=c),"plus"===t&&""===wceb.bookingMax&&(r=!1),(!r||wceb.maxOption<r)&&(r=wceb.maxOption);var n={};return n.min=a,n.max=r,n},wceb.get.closestDisabled=function(t,a,r){var i=new Date(t),c=i.getDay(),n=a.get("disable"),o=[];e.each(n,function(e,a){if(wceb.checkIf.isArray(a)){if("booked"===a.type||"no"===wceb.allowDisabled){var n=new Date(a[0],a[1],a[2]);o.push(n.getTime())}}else if(wceb.checkIf.isObject(a)){if("superior"===r)var n=new Date(a.from[0],a.from[1],a.from[2]);else var n=new Date(a.to[0],a.to[1],a.to[2]);"booked"!==a.type&&"no"!==wceb.allowDisabled||o.push(n.getTime())}else if(wceb.checkIf.isDate(a))o.push(a.getTime());else if("no"===wceb.allowDisabled&&wceb.checkIf.isDay(a))if("superior"===r){var d=Math.abs(c-a);0===d&&(d=7),a<c&&7!==d&&(d=7-d);var s=i.setDate(i.getDate()+d);o.push(s),i=new Date(t)}else if("inferior"===r){var d=Math.abs(c-a);0===d&&(d=7),c<a&&7!==d&&(d=7-d),previousDisabledDay=i.setDate(i.getDate()-d),o.push(previousDisabledDay)}}),o.sort();var d=wceb.get.closest(o,t,r);return d},wceb.get.closest=function(e,t,a){minClosest=!1;for(var r=0;r<e.length;r++)if("superior"===a){if(e[r]>t){minClosest=e[r];break}minClosest=!1}else"inferior"===a&&e[r]<t&&(minClosest=e[r]);return minClosest},wceb.createDateObject=function(e,t){var a={};if(!e)var e=new Date;if(t&&e.setDate(e.getDate()+t),"infinity"===e){var a={date:1/0,day:1/0,month:1/0,obj:1/0,pick:1/0,year:1/0};return a}if(!wceb.checkIf.isDate(e))return a;e.setHours(0,0,0,0);var a={date:e.getDate(),day:e.getDay(),month:e.getMonth(),obj:e,pick:e.getTime(),year:e.getFullYear()};return a},wceb.clearBookingSession=function(){if(wceb.session){var t={action:"clear_booking_session",security:e('input[name="_wceb_nonce"]').val()};e.post(wceb_object.ajax_url,t,function(e){wceb.session=e})}},wceb.applyBookingDuration=function(e,t,a){var r=t.disable,i="end"===e?t.max:t.min,c=new Date(a.year,a.month,a.date),n=t.view,o=new Date(n.year,n.month,0).getDate(),d=new Date(n.year,n.month+1,0).getDate(),s=new Date(n.year,n.month+2,0).getDate(),l=parseInt(o+d+s),b=Math.abs(Math.round((n.pick-a.pick)/864e5)),u="end"===e?parseInt(b-o):parseInt(b-d-s),p="end"===e?parseInt(b-o+l):parseInt(b-s+l);if("end"===e&&b<o)var u=wceb.bookingCustomDuration,p=parseInt(b+d+s);if("start"===e&&u<s)var u=wceb.bookingCustomDuration,p=parseInt(b+d+o);if(u<0&&(u=0),u<wceb.bookingCustomDuration)u=wceb.bookingCustomDuration;else{var f,m=[];for(f=0;f<=u;f+=wceb.bookingCustomDuration)m.push(f);var u=m.slice(-1)[0]}"days"===wceb.calcMode&&(u-=1);var w,k=[1,2,3,4,5,6,7];for(first=!1,w=u;w<=p;w+=wceb.bookingCustomDuration){var g=new Date(a.year,a.month,a.date);if("start"===e?g.setDate(c.getDate()-w):"end"===e&&g.setDate(c.getDate()+w),dateToEnable=wceb.createDateObject(g),"end"===e&&dateToEnable.obj>i.obj||"start"===e&&dateToEnable.obj<i.obj)break;if("undefined"!=typeof r&&r.length>0)var _=wceb.checkIf.isDisabled(r,dateToEnable);!0!==_&&k.push([dateToEnable.year,dateToEnable.month,dateToEnable.date,"inverted"])}return t.disable=r.concat(k),!1},wceb.formatPrice=function(e){return formatted_price=accounting.formatMoney(e,{symbol:wceb_object.currency_format_symbol,decimal:wceb_object.currency_format_decimal_sep,thousand:wceb_object.currency_format_thousand_sep,precision:wceb_object.currency_format_num_decimals,format:wceb_object.currency_format}),formatted_price},wceb.setPrice=function(){product_id=e("input[name=add-to-cart], button[name=add-to-cart]").val(),variation_id=e(".variations_form").find("input[name=variation_id]").val(),children=wceb.get.childrenIds(),t={};var a=e.fn.pickadate.defaults.format;t.startFormat=pickerStart.get("select","yyyy-mm-dd"),t.start=pickerStart.get("select",a),t.endFormat=pickerEnd.get("select","yyyy-mm-dd"),t.end=pickerEnd.get("select",a);var r=wceb.get.additionalCosts("each"),i={action:"add_new_price",security:e('input[name="_wceb_nonce"]').val(),product_id:product_id,variation_id:variation_id,children:children,start:t.start,end:t.end,start_format:t.startFormat,end_format:t.endFormat,additional_cost:r};e("form.cart, form.bundle_form").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent",backgroundSize:"16px 16px",opacity:.6}}),e.post(wceb_object.ajax_url,i,function(t){if(e(".woocommerce-error, .woocommerce-message").remove(),fragments=t.fragments,errors=t.errors,errors)return e.each(errors,function(t,a){e(t).replaceWith(a)}),wceb.pickers.init(),pickerStart.render(),pickerEnd.render(),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock(),!1;if(fragments){if(e.each(fragments,function(t,a){e(t).replaceWith(a)}),e(".cart").find('input[name="quantity"]').size())var a=parseFloat(e(".cart").find('input[name="quantity"]').val());else var a=1;var r=wceb.formatPrice(fragments.booking_price*a),c='<span class="woocommerce-Price-amount amount">'+r+"</span>";if(""!==fragments.booking_regular_price){var n=wceb.formatPrice(fragments.booking_regular_price*a),c='<del><span class="woocommerce-Price-amount amount">'+n+'</span></del> <ins><span class="woocommerce-Price-amount amount">'+r+"</span></ins>";e(".booking_price").attr("data-booking_regular_price",fragments.booking_regular_price)}e(".booking_price").attr("data-booking_price",fragments.booking_price).find(".price").html(c),wceb.session=fragments.session}e("body").trigger("update_price",[i,t]),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock()})},wceb.picker.set=function(){product_id=e("input[name=add-to-cart], button[name=add-to-cart]").val(),variation_id=e(".variations_form").find("input[name=variation_id]").val(),children=wceb.get.childrenIds(),t.startFormat=pickerStart.get("select","yyyy-mm-dd"),t.start=pickerStart.get("select","dd mmmm yyyy");var a={action:"add_new_price",security:e('input[name="_wceb_nonce"]').val(),product_id:product_id,variation_id:variation_id,children:children,start:t.start,start_format:t.startFormat,additional_cost:wceb.get.additionalCosts("each")};e("form.cart, form.bundle_form").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent",backgroundSize:"16px 16px",opacity:.6}}),e.post(wceb_object.ajax_url,a,function(t){if(e(".woocommerce-error, .woocommerce-message").remove(),fragments=t.fragments,errors=t.errors,errors)return e.each(errors,function(t,a){e(t).replaceWith(a)}),wceb.pickers.init(),pickerStart.render(),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock(),!1;if(fragments){if(e.each(fragments,function(t,a){e(t).replaceWith(a)}),fragments.booking_price){if(e(".cart").find('input[name="quantity"]').size())var r=parseFloat(e(".cart").find('input[name="quantity"]').val());else var r=1;var i=wceb.formatPrice(fragments.booking_price*r),c='<span class="woocommerce-Price-amount amount">'+i+"</span>";if(""!==fragments.booking_regular_price){var n=wceb.formatPrice(fragments.booking_regular_price*r),c='<del><span class="woocommerce-Price-amount amount">'+n+'</span></del> <ins><span class="woocommerce-Price-amount amount">'+i+"</span></ins>";e(".booking_price").attr("data-booking_regular_price",fragments.booking_regular_price)}e(".booking_price").attr("data-booking_price",fragments.booking_price).find(".price").html(c)}wceb.session=fragments.session}e("body").trigger("update_price",[a,t]),e("form.cart, form.bundle_form").stop(!0).css("opacity","1").unblock()})},wceb.picker.close=function(t,a){if(e(document.activeElement).blur(),"two"===wceb.dateFormat){var r=t.get("select"),i=a.get("select");wceb.checkIf.dateIsSet(r)&&!wceb.checkIf.dateIsSet(i)&&setTimeout(function(){a.open()},250)}},wceb.pickers.init=function(){pickerStartItem.disable=[],"two"===wceb.dateFormat&&(pickerEndItem.disable=[]);var t=wceb.get.firstAvailableDates(),a=t.start,r=a,i=wceb.createDateObject(new Date(wceb.maxYear,11,31)),c=wceb.createDateObject(new Date(r.year,r.month,1));if(pickerStartItem.clear=null,pickerStartItem.select=void 0,pickerStartItem.min=r,pickerStartItem.max=i,pickerStartItem.highlight=r,pickerStartItem.view=c,pickerStart.$node.val(""),"two"===wceb.dateFormat){var n=t.end,o=n,d=wceb.createDateObject(new Date(o.year,o.month,1));pickerEndItem.clear=null,pickerEndItem.select=void 0,pickerEndItem.min=o,pickerEndItem.max=i,pickerEndItem.highlight=o,pickerEndItem.view=d,pickerEnd.$node.val("")}return e(".single_add_to_cart_button").prop("disabled",!0),!1},wceb.pickers.render=function(t){var a=e("body");a.trigger("pickers_init",t),pickerStart.render(),pickerEnd.render(),a.trigger("after_pickers_init",t)},wceb.pickers.clearSecond=function(t,a,r){var i=r.component.item,c=wceb.get.firstAvailableDates(),n=c[a],o=wceb.createDateObject(wceb.maxOption),d=wceb.createDateObject(new Date(n.year,n.month,1));i.disable=[],i.min=n,i.max=o,null===r.get("select")&&(i.highlight=n,i.view=d),e("body").trigger("clear_"+t+"_picker",i),r.render()},wceb.pickers.set=function(t,a,r,i){var c=a.get("select"),n=r.get("select");if(null!==c){var o="start"===t?"superior":"inferior",d="start"===t?"plus":"minus",s=c.pick,l=wceb.get.minAndMax(c,d),b=l.min,u=l.max,p="start"===t?u:b;u||(u=wceb.maxOption);var f=wceb.get.closestDisabled(s,r,o);if(f){var m=new Date(f);if("start"===t&&f<p||"end"===t&&f>p)var p=m}var b="start"===t?wceb.createDateObject(b):wceb.createDateObject(p),u="start"===t?wceb.createDateObject(p):wceb.createDateObject(u),w=wceb.createDateObject(new Date(b.year,b.month,1));i.min=b,i.max=u,i.view=w,"undefined"!=typeof n&&null!==n||(i.highlight=b),e("body").trigger("set_"+t+"_picker",[i,s]),r.render(),wceb.checkIf.datesAreSet()&&wceb.setPrice()}},pickerStart.on({render:function(){pickerStart.$root.find(".picker__header").prepend('<div class="picker__title">'+wceb_object.start_text+"</div>")},set:function(a){"undefined"!=typeof a.clear&&null===a.clear&&("two"===wceb.dateFormat&&wceb.pickers.clearSecond("start","end",pickerEnd),t.start=null,t.startFormat=null,wceb.clearBookingSession(),e(".single_add_to_cart_button").prop("disabled",!0)),"two"===wceb.dateFormat&&wceb.checkIf.dateIsSet(a.select)?wceb.pickers.set("start",pickerStart,pickerEnd,pickerEndItem):"one"===wceb.dateFormat&&wceb.checkIf.dateIsSet(a.select)&&wceb.picker.set()},close:function(){wceb.picker.close(pickerStart,pickerEnd)}}),pickerEnd.on({render:function(){pickerEnd.$root.find(".picker__header").prepend('<div class="picker__title">'+wceb_object.end_text+"</div>")},set:function(a){return"undefined"!=typeof a.clear&&null===a.clear&&(wceb.pickers.clearSecond("end","start",pickerStart),t.end=null,t.endFormat=null,wceb.clearBookingSession(),e(".single_add_to_cart_button").prop("disabled",!0)),"two"===wceb.dateFormat&&wceb.checkIf.dateIsSet(a.select)&&wceb.pickers.set("end",pickerEnd,pickerStart,pickerStartItem),!1},close:function(){wceb.picker.close(pickerEnd,pickerStart)}}),e("body").on("pickers_init",function(e,t){var a=wceb.get.firstAvailableDates(),r=a.start;if(pickerStartItem.view=wceb.createDateObject(new Date(r.year,r.month,1)),pickerStartItem.highlight=r,"two"===wceb.dateFormat){var i=a.end;pickerEndItem.view=wceb.createDateObject(new Date(i.year,i.month,1)),pickerEndItem.highlight=i,pickerEndItem.min=i}return!1}),pickerStart.on("before_rendering",function(){if("two"===wceb.dateFormat){var e=pickerEnd.get("select");startPickerDisabled=pickerStartItem.disable,wceb.checkIf.dateIsSet(e)&&"days"!==wceb.bookingDuration&&wceb.bookingCustomDuration>1&&wceb.applyBookingDuration("start",pickerStartItem,e)}}),pickerStart.on("after_rendering",function(){"two"===wceb.dateFormat&&(pickerStartItem.disable=startPickerDisabled)}),pickerEnd.on("before_rendering",function(){var e=pickerStart.get("select");endPickerDisabled=pickerEndItem.disable,wceb.checkIf.dateIsSet(e)&&"days"!==wceb.bookingDuration&&wceb.bookingCustomDuration>1&&wceb.applyBookingDuration("end",pickerEndItem,e)}),pickerEnd.on("after_rendering",function(){pickerEndItem.disable=endPickerDisabled}),e(".cart").on("change",'input[name="quantity"]',function(){formatted_price=wceb.formatPrice(wceb.get.basePrice()),e(".booking_price").find(".price .amount").html(formatted_price),formatted_regular_price=wceb.formatPrice(wceb.get.regularPrice()),e(".booking_price").find(".price del .amount").html(formatted_regular_price)}),e("body").on("update_price",function(){e(".single_add_to_cart_button").prop("disabled",!1)}),e(".product-addon input, .product-addon textarea, .product-addon select, .product-addon input.qty").on("woocommerce-product-addons-update",function(){if("two"===wceb.dateFormat&&wceb.checkIf.datesAreSet())wceb.setPrice();else if("one"===wceb.dateFormat&&wceb.checkIf.dateIsSet("start"))wceb.picker.set();else{var t=wceb.formatPrice(wceb.get.basePrice());e(".booking_price").find(".price .amount").html(t),formatted_regular_price=wceb.formatPrice(wceb.get.regularPrice()),e(".booking_price").find(".price del .amount").html(formatted_regular_price)}})})}(jQuery);